<% include ../partials/header %>

<div class="card my-4 mx-md-5">
	<div class="card-header">
		<div class="row no-gutters align-items-center">
			<div class="col-auto mr-auto">
				<nav aria-label="breadcrumb">
					<h3 class="headtitle">
						<ol class="breadcrumb bg-transparent headtitle">
							<li class="breadcrumb-item"><a class="text-dark" href="/jobs/"><strong>Jobs</strong></a></li>
							<li class="breadcrumb-item active" aria-current="page"><%= job.jobId %> - <%= job.customerName %></li>
						</ol>
					</h3>
				</nav>
			</div>
			<div class="col-auto ml-auto ">
				<a class="btn btn-outline-warning btn-md float-right" href="/jobs/<%= job._id %>/edit">Edit</a>
			</div>
		</div>
	</div>
	<div class="card-body">
		<!-- Progress Bar -->
		<div class="mx-md-5">
			<% if(job.status === "Quoting"){ %>
				<div class="progress">
					<div class="progress-bar bg-secondary" role="progressbar" style="width: 20%;" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"><strong>Quoting</strong></div>
				</div>
			<% } else if(job.status === "Work in Progress") { %>
				<div class="progress">
					<div class="progress-bar bg-info" role="progressbar" style="width: 40%;" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100"><strong>Work in Progress</strong></div>
				</div>
			<% } else if(job.status === "Work Finished") { %>
				<div class="progress">
					<div class="progress-bar bg-success" role="progressbar" style="width: 60%;" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"><strong>Work Finished <small>(Ready for Invoice)</small></strong></div>
				</div>
			<% } else if(job.status === "Waiting for Payment") { %>
				<div class="progress">
					<div class="progress-bar bg-primary" role="progressbar" style="width: 80%;" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100"><strong>Waiting for Payment</strong></div>
				</div>
			<% } else if(job.status === "Job Complete") { %>
				<div class="progress">
					<div class="progress-bar bg-light text-dark" role="progressbar" style="width: 100%;" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"><strong>Job Complete <small>(Payed)</small></strong></div>
				</div>
			<% } else if(job.status === "On Hold") { %>
				<div class="progress">
					<div class="progress-bar bg-warning text-dark" role="progressbar" style="width: 100%;" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"><strong>On Hold</strong></div>
				</div>
			<% } else if(job.status === "On Clint's Desk") { %>
				<div class="progress">
					<div class="progress-bar bg-danger" role="progressbar" style="width: 75%;" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100"><strong>On Clint's Desk</strong></div>
				</div>
			<% } else { %>
				<div class="progress">
					<div class="progress-bar bg-white text-dark" role="progressbar" style="width: 100%;" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"><strong>Job Received</strong></div>
				</div>
			<% } %>
		</div>
		<!-- Customer Info Card -->
		<div class="card my-3 mx-md-5">
			<div class="card-header">
				<span class="align-middle"><strong>Customer Information</strong></span>
			</div>
			<div class="card-body">
				<div class="row">
					<div class="col-sm">
						<form>
							<div class="row">
								<div class="col-sm">
									<div class="form-group row">
										<label for="showJobId" class="col col-form-label text-right"><strong>Name</strong></label>
										<div class="col">
											<input type="text" readonly class="form-control-plaintext" id="showJobId" value="<%=job.customerName%>">
										</div>
									</div>
								</div>
							</div>
							<div class="row">
								<div class="col-sm">
									<div class="form-group row">
										<label for="showPhone" class="col col-form-label text-right"><strong>Phone Number</strong></label>
										<div class="col">
											<input type="text" readonly class="form-control-plaintext" id="showPhone" value="<%=job.phone%>">
										</div>
									</div>
								</div>
								<div class="col-sm"></div>
								<div class="col-sm">
									<div class="form-group row">
										<label for="showEmail" class="col col-form-label text-right"><strong>Email</strong></label>
										<div class=" col">
											<input type="email" readonly class="form-control-plaintext" id="showEmail" value="<%=job.email%>">
										</div>
									</div>
								</div>
								<div class="col-sm"></div>
								<div class="col-sm">
									<div class="form-group row">
										<label for="showAddress" class="col col-form-label text-right"><strong>Address</strong></label>
										<div class="col">
											<input type="text" readonly class="form-control-plaintext" id="showAddress" value="<%=job.address.street%>, <%=job.address.city%> <%=job.address.province%> <%=job.address.postal%>">
										</div>
									</div>
								</div>
								<div class="col-sm"></div>
							</div>
						</form>
					</div>
					<div class="col-sm"></div>
				</div>
			</div>
		</div>
		<!-- Claim Info Card -->
		<div class="card my-3 mx-md-5">
			<div class="card-header">
				<span class="align-middle"><strong>Claim Information</strong></span>
			</div>
			<div class="card-body">
				<form>
					<div class="row">
						<div class="col-sm">
							<div class="form-group row">
								<label for="showInsComp" class="col col-form-label text-right"><strong>Insur. Company</strong></label>
								<div class="col">
									<input type="test" readonly class="form-control-plaintext" id="showInsComp" value="<%=job.insComp%>">
								</div>
							</div>
							<div class="form-group row">
								<label for="showPolicyNum" class="col col-form-label text-right"><strong>Policy Number</strong></label>
								<div class="col">
									<input type="test" readonly class="form-control-plaintext" id="showPolicyNum" value="<%=job.policyNum%>">
								</div>
							</div>
							<div class="form-group row">
								<label for="showClaimNum" class="col col-form-label text-right"><strong>Claim Number</strong></label>
								<div class="col">
									<input type="test" readonly class="form-control-plaintext" id="showClaimNum" value="<%=job.claimNum%>">
								</div>
							</div>                        
						</div>
						<div class="col-sm">
							<div class="form-group row">
								<label for="showAdjComp" class="col col-form-label text-right"><strong>Adjust. Company</strong></label>
								<div class="col">
									<input type="test" readonly class="form-control-plaintext" id="showAdjComp" value="<%=job.adjComp%>">
								</div>
							</div>
							<div class="form-group row">
								<label for="showAdjuster" class="col col-form-label text-right"><strong>Adjuster</strong></label>
								<div class="col">
									<input type="test" readonly class="form-control-plaintext" id="showAdjuster" value="<%=job.adjuster%>">
								</div>
							</div>
							<div class="form-group row">
								<label for="showFileNum" class="col col-form-label text-right"><strong>File Number</strong></label>
								<div class="col">
									<input type="test" readonly class="form-control-plaintext" id="showFileNum" value="<%=job.fileNum%>">
								</div>
							</div>                        
						</div>
					</div>
					<div class="row">
						<div class="col-sm">
							<div class="form-group row">
								<label for="showDateOfLoss" class="col col-form-label text-right"><strong>Date of Loss</strong></label>
								<div class="col">
									<input type="test" readonly class="form-control-plaintext" id="showDateOfLoss" value="<% if(job.dateOfLoss){ %><%= job.dateOfLoss.toDateString() %><% } %>">
								</div>
							</div>
						</div>
						<div class="col-sm">
							<div class="form-group row">
								<label for="showDeductible" class="col col-form-label text-right"><strong>Deductible</strong></label>
								<div class="col">
									<input type="test" readonly class="form-control-plaintext" id="showDeductible" value="<%=job.deductible%>">
								</div>
							</div>   
						</div>
					</div>
				</form>
			</div>
		</div>
		<!-- Comments Card -->
		<div class="card my-3 mx-md-5">
			<div class="card-header">
				<div class="row no-gutters align-items-center">
					<div class="col-auto mr-auto">
						<span class="align-middle"><strong>Comments</strong></span>
					</div>
					<div class="col-auto ml-auto">
						<a class="btn btn-outline-success btn-sm" href="/jobs/<%= job._id %>/comments/new">Add Comment</a>
					</div>  
				</div>
			</div>
			<div class="card-body d-flex flex-column-reverse">
				<% job.comments.forEach(function(comment){ %>
					<div class="row ">
						<div class="col-md-12 my-2 ">
							<div>
								<strong><%= comment.author.username %></strong>
								<!--check if comment has been edited or is original and show when last edited-->
								<span class="float-right small">
									<% if(moment(comment.modifiedAt).isAfter(comment.createdAt)){ %>
										Edited <%= moment(comment.modifiedAt).fromNow() %>
									<% } else { %>
										Created <%= moment(comment.createdAt).fromNow() %>
									<% } %>
								</span>
							</div>
							<div>
								<%= comment.text %>
								<% if(currentUser && comment.author.id.equals(currentUser._id) || currentUser && currentUser.isAdmin){ %>
									<a class="btn btn-outline-warning btn-sm float-right" href="/jobs/<%=job._id%>/comments/<%=comment._id%>/edit">Edit</a>
								<% } %>
							</div>
						</div>
					</div>
				<% }); %>
			</div>
		</div>
	</div>
	<div class="card-footer">
		<a class="btn btn-sm btn-outline-secondary" href="/jobs">Go Back</a>
	</div>
</div>

<% include ../partials/footer %>
